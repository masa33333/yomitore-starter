<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>èª­ã¿ãƒˆãƒ¬é€šçŸ¥ã‚·ã‚¹ãƒ†ãƒ  ãƒ†ã‚¹ãƒˆ</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-section { border: 1px solid #ccc; margin: 10px 0; padding: 15px; }
        .test-result { background: #f0f0f0; padding: 10px; margin: 10px 0; }
        button { padding: 8px 16px; margin: 5px; cursor: pointer; }
        .success { color: green; }
        .error { color: red; }
    </style>
</head>
<body>
    <h1>ğŸ“® èª­ã¿ãƒˆãƒ¬é€šçŸ¥ã‚·ã‚¹ãƒ†ãƒ  ãƒ†ã‚¹ãƒˆ</h1>
    
    <div class="test-section">
        <h2>1. åŸºæœ¬è¨­å®šãƒ†ã‚¹ãƒˆ</h2>
        <button onclick="testBasicSettings()">åŸºæœ¬è¨­å®šç¢ºèª</button>
        <div id="basicResults" class="test-result"></div>
    </div>

    <div class="test-section">
        <h2>2. èªå½™ãƒ¬ãƒ™ãƒ«åˆ¥ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ãƒ†ã‚¹ãƒˆ</h2>
        <button onclick="testVocabLevels()">èªå½™ãƒ¬ãƒ™ãƒ«åˆ¥è¡¨ç¤º</button>
        <div id="vocabResults" class="test-result"></div>
    </div>

    <div class="test-section">
        <h2>3. æ‰‹ç´™ãƒ»ãƒ¡ãƒ¼ãƒ«è¡¨ç¤ºãƒ†ã‚¹ãƒˆ</h2>
        <button onclick="testLetterMail()">æ‰‹ç´™ãƒ»ãƒ¡ãƒ¼ãƒ«åˆ‡ã‚Šæ›¿ãˆ</button>
        <div id="letterMailResults" class="test-result"></div>
    </div>

    <div class="test-section">
        <h2>4. æ¡ä»¶é”æˆã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³</h2>
        <button onclick="simulateWordCount()">èªæ•°é”æˆã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ãƒˆ</button>
        <button onclick="simulateReadingTime()">èª­æ›¸æ™‚é–“é”æˆã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ãƒˆ</button>
        <div id="simulationResults" class="test-result"></div>
    </div>

    <script>
        async function testBasicSettings() {
            const results = document.getElementById('basicResults');
            results.innerHTML = '';
            
            // localStorage ã®åŸºæœ¬è¨­å®šã‚’ç¢ºèª
            const catName = localStorage.getItem('catName') || 'ã­ã“';
            const vocabLevel = localStorage.getItem('vocabLevel') || 'L1';
            const totalWords = localStorage.getItem('totalWordsRead') || '0';
            
            results.innerHTML += `<p class="success">âœ… çŒ«ã®åå‰: ${catName}</p>`;
            results.innerHTML += `<p class="success">âœ… èªå½™ãƒ¬ãƒ™ãƒ«: ${vocabLevel}</p>`;
            results.innerHTML += `<p class="success">âœ… ç´¯è¨ˆèª­æ›¸èªæ•°: ${totalWords}èª</p>`;
        }

        async function testVocabLevels() {
            const results = document.getElementById('vocabResults');
            results.innerHTML = '<p>èªå½™ãƒ¬ãƒ™ãƒ«åˆ¥ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’ç¢ºèªä¸­...</p>';
            
            const levels = ['L1', 'L2', 'L3', 'L4', 'L5'];
            let testResults = '';
            
            for (const level of levels) {
                try {
                    const response = await fetch(`/content/letters/tokyo-seoul/${level}.json`);
                    if (response.ok) {
                        const data = await response.json();
                        testResults += `<p class="success">âœ… ${level}: ${data.stats.word_count}èª (ã‚³ã‚¢èªå½™${data.stats.L_core}%)</p>`;
                    } else {
                        testResults += `<p class="error">âŒ ${level}: èª­ã¿è¾¼ã¿å¤±æ•—</p>`;
                    }
                } catch (error) {
                    testResults += `<p class="error">âŒ ${level}: ã‚¨ãƒ©ãƒ¼ - ${error.message}</p>`;
                }
            }
            
            results.innerHTML = testResults;
        }

        async function testLetterMail() {
            const results = document.getElementById('letterMailResults');
            results.innerHTML = '<p>æ‰‹ç´™ãƒ»ãƒ¡ãƒ¼ãƒ«è¡¨ç¤ºã‚’ãƒ†ã‚¹ãƒˆä¸­...</p>';
            
            let testResults = '';
            
            // æ‰‹ç´™ãƒ†ã‚¹ãƒˆ
            try {
                const letterResponse = await fetch('/content/letters/tokyo-seoul/L3.json');
                if (letterResponse.ok) {
                    const letterData = await letterResponse.json();
                    testResults += `<p class="success">âœ… æ‰‹ç´™: ${letterData.type} - ${letterData.stats.word_count}èª</p>`;
                }
            } catch (error) {
                testResults += `<p class="error">âŒ æ‰‹ç´™èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼</p>`;
            }
            
            // ãƒ¡ãƒ¼ãƒ«ãƒ†ã‚¹ãƒˆ
            try {
                const mailResponse = await fetch('/content/mails/tokyo-seoul/mail1_L3.json');
                if (mailResponse.ok) {
                    const mailData = await mailResponse.json();
                    testResults += `<p class="success">âœ… ãƒ¡ãƒ¼ãƒ«: ${mailData.type} - ${mailData.stats.word_count}èª</p>`;
                }
            } catch (error) {
                testResults += `<p class="error">âŒ ãƒ¡ãƒ¼ãƒ«èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼</p>`;
            }
            
            results.innerHTML = testResults;
        }

        function simulateWordCount() {
            const results = document.getElementById('simulationResults');
            
            // èªæ•°é”æˆã‚’ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ãƒˆ
            const currentWords = parseInt(localStorage.getItem('totalWordsRead') || '0');
            const targetWords = 5000; // Tokyo â†’ Seoul ã®é–¾å€¤
            
            if (currentWords >= targetWords) {
                results.innerHTML = `<p class="success">âœ… èªæ•°æ¡ä»¶é”æˆæ¸ˆã¿: ${currentWords}èª >= ${targetWords}èª</p>`;
                results.innerHTML += `<p><a href="/letter?type=letter&route=tokyo-seoul&level=L3" target="_blank">â†’ Seoulåˆ°ç€æ‰‹ç´™ã‚’è¡¨ç¤º</a></p>`;
            } else {
                // æ¡ä»¶é”æˆã‚’ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ãƒˆ
                localStorage.setItem('totalWordsRead', targetWords.toString());
                results.innerHTML = `<p class="success">âœ… èªæ•°æ¡ä»¶é”æˆã‚’ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ãƒˆ: ${targetWords}èª</p>`;
                results.innerHTML += `<p><a href="/letter?type=letter&route=tokyo-seoul&level=L3" target="_blank">â†’ Seoulåˆ°ç€æ‰‹ç´™ã‚’è¡¨ç¤º</a></p>`;
            }
        }

        function simulateReadingTime() {
            const results = document.getElementById('simulationResults');
            
            // èª­æ›¸æ™‚é–“é”æˆã‚’ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ãƒˆ
            const readingTime = 5; // 5åˆ†çµŒé
            
            results.innerHTML = `<p class="success">âœ… èª­æ›¸æ™‚é–“æ¡ä»¶é”æˆã‚’ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ãƒˆ: ${readingTime}åˆ†</p>`;
            results.innerHTML += `<p><a href="/letter?type=mail&route=tokyo-seoul&level=L3&mail=1" target="_blank">â†’ æ©Ÿå†…ãƒ¡ãƒ¼ãƒ«1é€šç›®ã‚’è¡¨ç¤º</a></p>`;
        }

        // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã«åŸºæœ¬è¨­å®šã‚’ãƒ†ã‚¹ãƒˆ
        window.onload = function() {
            testBasicSettings();
        };
    </script>
</body>
</html>